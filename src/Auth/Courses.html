<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Danh S√°ch Kh√≥a H·ªçc</title>

    <link rel="stylesheet" href="layout.css">
    <link rel="stylesheet" href="courses.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>

<div id="layout-container"></div>

<main class="main-content">
    <section class="courses-page">
        <div class="container courses-layout">

            <!-- ===== SIDEBAR FILTER ===== -->
            <aside class="sidebar">
                <h3>B·ªô L·ªçc</h3>

                <!-- CATEGORY -->
                <div class="filter-group">
                    <h4>M·ª•c ti√™u</h4>
                    <label><input type="checkbox" class="filter-category" value="ielts"> IELTS</label>
                    <label><input type="checkbox" class="filter-category" value="toeic"> TOEIC</label>
                    <label><input type="checkbox" class="filter-category" value="giaotiep"> Giao ti·∫øp</label>
                </div>

                <!-- LEVEL -->
                <div class="filter-group">
                    <h4>Tr√¨nh ƒë·ªô</h4>
                    <label><input type="checkbox" class="filter-level" value="beginner"> Beginner</label>
                    <label><input type="checkbox" class="filter-level" value="intermediate"> Intermediate</label>
                    <label><input type="checkbox" class="filter-level" value="advanced"> Advanced</label>
                </div>

                <!-- AGE GROUP -->
                <div class="filter-group">
                    <h4>ƒê·ªô tu·ªïi</h4>
                    <label><input type="checkbox" class="filter-age" value="kid"> Thi·∫øu nhi</label>
                    <label><input type="checkbox" class="filter-age" value="student"> Sinh vi√™n</label>
                    <label><input type="checkbox" class="filter-age" value="working"> Ng∆∞·ªùi ƒëi l√†m</label>
                </div>
            </aside>

            <!-- ===== MAIN CONTENT ===== -->
            <div class="courses-content">

                <!-- SEARCH + SORT -->
                <div class="courses-topbar">
                    <div class="search-box">
                        <input type="text"
                               id="searchInput"
                               placeholder="T√¨m ki·∫øm kh√≥a h·ªçc...">

                        <button id="searchBtn">
                            üîç
                        </button>
                    </div>

                    <select id="sortSelect">
                        <option value="">S·∫Øp x·∫øp theo</option>
                        <option value="popular">Ph·ªï bi·∫øn</option>
                        <option value="fee-asc">H·ªçc ph√≠ tƒÉng d·∫ßn</option>
                        <option value="fee-desc">H·ªçc ph√≠ gi·∫£m d·∫ßn</option>
                        <option value="date">Khai gi·∫£ng s·ªõm</option>
                    </select>
                </div>

                <!-- GRID -->
                <div class="courses-grid" id="coursesContainer"></div>

            </div>
        </div>
    </section>
</main>

<script src="../FakeData/courses-data.js"></script>
<script src="layout.js"></script>

<script>
        document.addEventListener("DOMContentLoaded", function () {

        loadLayout();

        const container = document.getElementById("coursesContainer");
        const searchInput = document.getElementById("searchInput");
        const searchBtn = document.getElementById("searchBtn");
        const sortSelect = document.getElementById("sortSelect");
           // STATE

        let currentList = [...courses];
        /*
           FORMAT HELPERS
         */
        function formatCurrency(amount) {
        return amount.toLocaleString("vi-VN") + "ƒë";
    }

        function formatDate(dateString) {
        return new Date(dateString).toLocaleDateString("vi-VN");
    }
           //RENDER
        function renderCourses(list) {

        container.innerHTML = "";

        if (list.length === 0) {
        container.innerHTML = "<p>Kh√¥ng t√¨m th·∫•y kh√≥a h·ªçc ph√π h·ª£p.</p>";
        return;
    }

        list.forEach(course => {
        container.innerHTML += `
                <div class="course-card">
                    <h3>${course.title}</h3>
                    <p><strong>M·ª•c ti√™u:</strong> ${course.goal}</p>
                    <p><strong>H·ªçc ph√≠:</strong> ${formatCurrency(course.fee)}</p>
                    <p><strong>Th·ªùi l∆∞·ª£ng:</strong> ${course.totalLessons} bu·ªïi (${course.durationWeeks} tu·∫ßn)</p>
                    <p><strong>Khai gi·∫£ng:</strong> ${formatDate(course.startDate)}</p>
                    <p><strong>ƒê·ªëi t∆∞·ª£ng:</strong> ${course.ageGroup}</p>
                    <a href="Courses_Details.html?id=${course.id}" class="detail-btn">
                        Xem chi ti·∫øt
                    </a>
                </div>
            `;
    });
    }
           //FILTER

        function applyFilters() {

        const searchText = searchInput.value.trim().toLowerCase();

        const selectedCategories = [...document.querySelectorAll(".filter-category:checked")]
        .map(cb => cb.value);

        const selectedLevels = [...document.querySelectorAll(".filter-level:checked")]
        .map(cb => cb.value);

        const selectedAges = [...document.querySelectorAll(".filter-age:checked")]
        .map(cb => cb.value);

        currentList = courses.filter(course => {

        const matchSearch =
        !searchText ||
        course.title.toLowerCase().includes(searchText);

        const matchCategory =
        selectedCategories.length === 0 ||
        selectedCategories.includes(course.category);

        const matchLevel =
        selectedLevels.length === 0 ||
        selectedLevels.includes(course.level);

        const matchAge =
        selectedAges.length === 0 ||
        selectedAges.includes(course.ageGroup);

        return matchSearch && matchCategory && matchLevel && matchAge;
    });

        applySort();
    }
           //SORT
        function applySort() {

        const sortValue = sortSelect.value;

        const sortedList = [...currentList];

        switch (sortValue) {

        case "popular":
        sortedList.sort((a, b) =>
        b.enrollmentCount - a.enrollmentCount
        );
        break;

        case "fee-asc":
        sortedList.sort((a, b) =>
        a.fee - b.fee
        );
        break;

        case "fee-desc":
        sortedList.sort((a, b) =>
        b.fee - a.fee
        );
        break;

        case "date":
        sortedList.sort((a, b) =>
        new Date(a.startDate) - new Date(b.startDate)
        );
        break;
    }

        renderCourses(sortedList);
    }


           //SEARCH EVENTS

        function handleSearch() {
        applyFilters();
    }

        // Click k√≠nh l√∫p
        searchBtn.addEventListener("click", handleSearch);

        // Nh·∫•n Enter
        searchInput.addEventListener("keypress", function (e) {
        if (e.key === "Enter") {
        handleSearch();
    }
    });

          // FILTER EVENTS
        document.querySelectorAll(".filter-category, .filter-level, .filter-age")
        .forEach(cb =>
        cb.addEventListener("change", applyFilters)
        );

        sortSelect.addEventListener("change", applySort);


        const params = new URLSearchParams(window.location.search);
        const categoryFromURL = params.get("category");

        if (categoryFromURL) {
        currentList = courses.filter(c =>
        c.category === categoryFromURL
        );
    }

        renderCourses(currentList);

    });
</script>

</body>
</html>