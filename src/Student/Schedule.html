<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lịch học & Lớp học</title>
    <link rel="stylesheet" href="student.css">
    <link rel="stylesheet" href="Schedule.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>

<div class="layout">

    <div id="layout-container"></div>

    <div class="main-wrapper">
        <main class="content">
            <div class="content-container">

                <!-- ===== LỚP ĐANG HỌC ===== -->
                <section>
                    <h1>Lớp đang học</h1>
                    <div id="classGrid" class="class-grid"></div>
                </section>

                <!-- ===== TIẾT HỌC SẮP TỚI ===== -->
                <section style="margin-top:40px;">
                    <h1>Tiết học sắp tới</h1>
                    <div id="upcomingList" class="upcoming-list"></div>
                </section>

            </div>
        </main>
    </div>
</div>

<!-- ===== TEMPLATE: CLASS CARD ===== -->
<template id="classCardTemplate">
    <div class="class-card">
        <div class="class-header">
            <span class="class-code"></span>
            <span class="next-session"></span>
        </div>

        <h3 class="class-name"></h3>
        <p class="class-teacher"></p>
        <p class="class-progress-text"></p>

        <div class="progress-bar">
            <div class="progress"></div>
        </div>
    </div>
</template>

<!-- ===== TEMPLATE: UPCOMING ITEM ===== -->
<template id="upcomingTemplate">
    <div class="upcoming-item">
        <div class="time"></div>
        <div class="info">
            <h4 class="upcoming-name"></h4>
            <p class="upcoming-meta"></p>
            <button class="detail-btn">Xem chi tiết</button>
        </div>
    </div>
</template>

<script src="../FakeData/student-data.js"></script>
<script src="../FakeData/Notification-data.js"></script>
<script src="layout.js"></script>
<script>
    document.addEventListener("DOMContentLoaded", function () {

        loadLayout(function () {

            renderClasses(student.classes);
            renderUpcoming(student.classes);

        });

    });

    // ==========================
    // RENDER CLASS CARDS
    // ==========================

    function renderClasses(classes) {

        const grid = document.getElementById("classGrid");
        const template = document.getElementById("classCardTemplate");

        classes.forEach(cls => {

            const clone = template.content.cloneNode(true);

            const percent =
                (cls.completedLessons / cls.totalLessons) * 100;

            clone.querySelector(".class-code").innerText = cls.code;
            clone.querySelector(".next-session").innerText =
                `Sắp tới: ${cls.nextSession}`;

            clone.querySelector(".class-name").innerText = cls.name;
            clone.querySelector(".class-teacher").innerText =
                `Giảng viên: ${cls.teacher}`;

            clone.querySelector(".class-progress-text").innerText =
                `Tiến trình: ${cls.completedLessons}/${cls.totalLessons}`;

            clone.querySelector(".progress").style.width =
                percent + "%";

            const card = clone.querySelector(".class-card");

            card.style.cursor = "pointer";
            card.addEventListener("click", function () {
                window.location.href =
                    `Class_Detail.html?id=${cls.code}`;
            });

            grid.appendChild(clone);

        });
    }

    // ==========================
    // RENDER UPCOMING
    // ==========================

    function renderUpcoming(classes) {

        const container = document.getElementById("upcomingList");
        const template = document.getElementById("upcomingTemplate");

        classes.forEach(cls => {

            cls.sessions.forEach(session => {

                const clone = template.content.cloneNode(true);

                clone.querySelector(".time").innerText =
                    session.time.split(" - ")[0];

                clone.querySelector(".upcoming-name").innerText =
                    cls.name;

                clone.querySelector(".upcoming-meta").innerText =
                    `${session.date} - ${session.room}`;

                const btn =
                    clone.querySelector(".detail-btn");

                btn.addEventListener("click", function () {
                    window.location.href =
                        `Class_Detail.html?id=${cls.code}`;
                });

                container.appendChild(clone);

            });

        });
    }
</script>

</body>
</html>