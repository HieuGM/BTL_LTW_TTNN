<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard H·ªçc vi√™n</title>
    <link rel="stylesheet" href="student.css">
    <link rel="stylesheet" href="dashboard.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>

<div class="layout">

    <!-- Layout d√πng chung -->
    <div id="layout-container"></div>

    <!-- MAIN CONTENT -->
    <div class="main-wrapper">
        <main class="content">
            <div class="content-container">

        <h1 id="studentName"></h1>

        <!-- ===== QUICK STATS ===== -->
                <div class="info-bar">

                    <div class="info-item blue">
                        <div class="info-left">
                            <i class="fas fa-book-open"></i>
                            <span>L·ªõp ƒëang h·ªçc</span>
                        </div>
                        <div class="info-value" id="totalClasses"></div>
                    </div>

                    <div class="info-item purple">
                        <div class="info-left">
                            <i class="fas fa-calendar-check"></i>
                            <span>T·ªïng bu·ªïi ƒë√£ h·ªçc</span>
                        </div>
                        <div class="info-value" id="totalProgress"></div>
                    </div>

                    <div class="info-item green tuition-box">
                        <div class="info-left">
                            <i class="fas fa-wallet"></i>
                            <span>H·ªçc ph√≠</span>
                        </div>

                        <div class="tuition-info">
                            <div class="tuition-amount" id="tuitionPaid"></div>
                            <div class="tuition-debt" id="tuitionDebt"></div>

                            <div class="progress-bar small">
                                <div id="tuitionBar" class="progress"></div>
                            </div>
                        </div>
                    </div>

                    <div class="info-item orange">
                        <div class="info-left">
                            <i class="fas fa-bell"></i>
                            <span>Th√¥ng b√°o</span>
                        </div>
                        <div class="info-value" id="dashboardUnread"></div>
                    </div>

                </div>

        <!-- ===== CLASS LIST ===== -->
        <h2 style="margin-top:40px;">C√°c l·ªõp ƒëang h·ªçc</h2>
        <div id="classGrid" class="class-grid"></div>

            </div>
        </main>
    </div>

</div>

<!-- TEMPLATE CLASS CARD -->
<template id="classCardTemplate">
    <div class="class-card">
        <div class="class-header">
            <span class="class-code"></span>
            <span class="next-session"></span>
        </div>

        <h3 class="class-name"></h3>
        <p class="class-teacher"></p>

        <p class="class-progress-text"></p>

        <div class="progress-bar">
            <div class="progress"></div>
        </div>
    </div>
</template>

<script src="../FakeData/student-data.js"></script>
<script src="../FakeData/Notification-data.js"></script>
<script src="./layout.js"></script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        loadLayout(function () {


                document.getElementById("studentName").innerText =
                    `Xin ch√†o, ${student.name} üëã`;

                document.getElementById("totalClasses").innerText =
                    student.classes.length;

                let totalCompleted = 0;
                student.classes.forEach(cls => {
                    totalCompleted += cls.completedLessons;
                });

                document.getElementById("totalProgress").innerText =
                    totalCompleted;

            // ===== TUITION =====

            const total = student.tuition.total;
            const paid = student.tuition.paid;
            const debt = total - paid;

            document.getElementById("tuitionPaid").innerText =
                "T·ªïng: " + total.toLocaleString("vi-VN") + " ƒë";

            document.getElementById("tuitionDebt").innerText =
                "C√≤n n·ª£: " + debt.toLocaleString("vi-VN") + " ƒë";

            const percentTuition = (paid / total) * 100;

            document.getElementById("tuitionBar").style.width =
                percentTuition + "%";

                // ===== TH√îNG B√ÅO =====

                if (typeof notifications !== "undefined") {
                    const unread =
                        notifications.filter(n => !n.read).length;

                    document.getElementById("dashboardUnread").innerText =
                        unread;
                }

                // ===== RENDER CLASS =====

                const grid = document.getElementById("classGrid");
                const template = document.getElementById("classCardTemplate");

                student.classes.forEach(cls => {

                    const clone = template.content.cloneNode(true);

                    const percent =
                        (cls.completedLessons / cls.totalLessons) * 100;

                    clone.querySelector(".class-code").innerText =
                        cls.code;

                    clone.querySelector(".next-session").innerText =
                        `S·∫Øp t·ªõi: ${cls.nextSession}`;

                    clone.querySelector(".class-name").innerText =
                        cls.name;

                    clone.querySelector(".class-teacher").innerText =
                        `Gi·∫£ng vi√™n: ${cls.teacher}`;

                    clone.querySelector(".class-progress-text").innerText =
                        `Ti·∫øn tr√¨nh: ${cls.completedLessons}/${cls.totalLessons}`;

                    clone.querySelector(".progress").style.width =
                        percent + "%";

                    clone.querySelector(".class-card")
                        .addEventListener("click", function () {
                            window.location.href =
                                `Class_Detail.html?id=${cls.code}`;
                        });

                    grid.appendChild(clone);
                });
        });
    });

</script>

</body>
</html>
