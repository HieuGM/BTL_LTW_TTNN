<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>B√°o c√°o T√†i ch√≠nh ‚Äì K·∫ø to√°n</title>
    <link rel="stylesheet" href="accountant.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .period-btn {
            padding: 6px 16px;
            border: 1px solid var(--border-color);
            background: white;
            border-radius: 6px;
            cursor: pointer;
            font-size: .82rem;
            font-weight: 500;
            color: var(--text-secondary);
            transition: all .15s;
        }
        .period-btn.active {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }
        .kpi-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1rem;
            margin-bottom: 1.25rem;
        }
        .kpi-card {
            background: white;
            border-radius: var(--radius);
            padding: 1.25rem;
            border: 1px solid var(--border-color);
            box-shadow: var(--shadow-sm);
            text-align: center;
        }
        .kpi-card .kpi-val { font-size: 1.6rem; font-weight: 800; }
        .kpi-card .kpi-label { font-size: .78rem; color: var(--text-secondary); margin-top: .25rem; }
        .kpi-card .kpi-change { font-size: .78rem; margin-top: .4rem; }
        .kpi-change.up   { color: var(--success); }
        .kpi-change.down { color: var(--danger); }
        .bar-chart-full {
            display: flex;
            align-items: flex-end;
            gap: 10px;
            height: 180px;
            padding: 0 8px;
        }
        .bar-group {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 6px;
            height: 100%;
            justify-content: flex-end;
        }
        .bar-full {
            width: 100%;
            background: var(--primary-light);
            border-radius: 5px 5px 0 0;
            border: 2px solid var(--primary-color);
            cursor: pointer;
            position: relative;
            transition: all .3s ease;
            display: flex;
            align-items: flex-end;
            justify-content: center;
        }
        .bar-full:hover { background: var(--primary-color); }
        .bar-full-val {
            position: absolute;
            top: -20px;
            font-size: .65rem;
            font-weight: 700;
            color: var(--primary-color);
            white-space: nowrap;
        }
        .bar-full:hover .bar-full-val { color: white; top: -20px; }
        .bar-full-label { font-size: .68rem; color: var(--text-secondary); }
        @media print {
            .sidebar, .page-header-actions, .filter-bar, .tabs, .btn-primary, .btn-secondary, .btn-danger { display: none!important; }
            .content { margin: 0; padding: 1rem; }
        }
    </style>
</head>
<body>
<div class="layout">

    <!-- SIDEBAR -->
    <aside class="sidebar">
        <div class="sidebar-header">
            <h2><i class="fas fa-graduation-cap"></i> Trung t√¢m Anh ng·ªØ</h2>
            <p>H·ªá th·ªëng qu·∫£n l√Ω</p>
            <span class="sidebar-role-badge"><i class="fas fa-coins"></i> Nh√¢n vi√™n K·∫ø to√°n</span>
        </div>
        <nav class="sidebar-nav">
            <span class="nav-section-title">T·ªïng quan</span>
            <a href="dashboard.html" class="nav-item"><i class="fas fa-home"></i> Dashboard</a>

            <span class="nav-section-title">T√†i ch√≠nh</span>
            <a href="TuitionManagement.html" class="nav-item"><i class="fas fa-file-invoice-dollar"></i> H·ªçc ph√≠ &amp; Phi·∫øu thu</a>
            <a href="DebtManagement.html" class="nav-item"><i class="fas fa-exclamation-triangle"></i> Qu·∫£n l√Ω c√¥ng n·ª£</a>

            <span class="nav-section-title">B√°o c√°o</span>
            <a href="FinancialReport.html" class="nav-item active"><i class="fas fa-chart-line"></i> B√°o c√°o t√†i ch√≠nh</a>

            <span class="nav-section-title">T√†i kho·∫£n</span>
            <a href="../Auth/Login.html" class="nav-item"><i class="fas fa-sign-out-alt"></i> ƒêƒÉng xu·∫•t</a>
        </nav>
    </aside>

    <!-- MAIN -->
    <main class="content">
        <header class="page-header">
            <div>
                <h1>B√°o c√°o T√†i ch√≠nh</h1>
                <p style="color:var(--text-secondary);font-size:.85rem;">T·ªïng h·ª£p doanh thu, c√¥ng n·ª£ v√† hi·ªáu su·∫•t thu ti·ªÅn</p>
            </div>
            <div class="page-header-actions">
                <button class="btn-secondary" onclick="exportCSV()"><i class="fas fa-file-csv"></i> Xu·∫•t CSV</button>
                <button class="btn-secondary" onclick="window.print()"><i class="fas fa-print"></i> In b√°o c√°o</button>
            </div>
        </header>

        <!-- PERIOD SELECTOR -->
        <div class="card" style="padding:.9rem 1.25rem;margin-bottom:1.25rem">
            <div style="display:flex;align-items:center;gap:1rem;flex-wrap:wrap">
                <span style="font-size:.85rem;font-weight:600;color:var(--text-secondary)">K·ª≥ b√°o c√°o:</span>
                <div style="display:flex;gap:.5rem;flex-wrap:wrap" id="periodBtns">
                    <button class="period-btn active" data-period="month" onclick="setPeriod('month',this)">Th√°ng n√†y</button>
                    <button class="period-btn" data-period="last3" onclick="setPeriod('last3',this)">3 th√°ng</button>
                    <button class="period-btn" data-period="last6" onclick="setPeriod('last6',this)">6 th√°ng</button>
                    <button class="period-btn" data-period="year" onclick="setPeriod('year',this)">NƒÉm nay</button>
                    <button class="period-btn" data-period="all" onclick="setPeriod('all',this)">T·∫•t c·∫£</button>
                </div>
                <div style="margin-left:auto;display:flex;gap:.5rem">
                    <input type="month" id="fromMonth" style="padding:5px 8px;border:1px solid var(--border-color);border-radius:6px;font-size:.82rem">
                    <input type="month" id="toMonth"   style="padding:5px 8px;border:1px solid var(--border-color);border-radius:6px;font-size:.82rem">
                    <button class="btn-primary" style="padding:5px 12px;font-size:.82rem" onclick="applyCustomPeriod()">√Åp d·ª•ng</button>
                </div>
            </div>
        </div>

        <!-- KPI CARDS -->
        <div class="kpi-grid" id="kpiGrid"></div>

        <!-- TABS -->
        <div class="tabs">
            <button class="tab-btn active" onclick="switchTab('revenue',this)"><i class="fas fa-chart-bar"></i> Doanh thu</button>
            <button class="tab-btn" onclick="switchTab('class',this)"><i class="fas fa-layer-group"></i> Theo l·ªõp</button>
            <button class="tab-btn" onclick="switchTab('debt',this)"><i class="fas fa-exclamation-circle"></i> C√¥ng n·ª£</button>
            <button class="tab-btn" onclick="switchTab('payments',this)"><i class="fas fa-history"></i> L·ªãch s·ª≠ thu ti·ªÅn</button>
        </div>

        <!-- TAB: REVENUE -->
        <div class="tab-content active" id="tab-revenue">
            <div class="card">
                <div class="card-header">
                    <h3><i class="fas fa-chart-bar" style="color:var(--primary-color)"></i> Bi·ªÉu ƒë·ªì doanh thu</h3>
                    <span id="chartSubtitle" style="font-size:.8rem;color:var(--text-secondary)"></span>
                </div>
                <div class="bar-chart-full" id="revenueChart"></div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h3><i class="fas fa-table" style="color:var(--info)"></i> Chi ti·∫øt theo th√°ng</h3>
                </div>
                <div class="table-wrapper">
                    <table id="revenueTable">
                        <thead>
                            <tr><th>Th√°ng/NƒÉm</th><th>Doanh thu</th><th>So th√°ng tr∆∞·ªõc</th><th>L≈©y k·∫ø nƒÉm</th></tr>
                        </thead>
                        <tbody id="revenueTableBody"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- TAB: BY CLASS -->
        <div class="tab-content" id="tab-class">
            <div class="card">
                <div class="card-header">
                    <h3><i class="fas fa-layer-group" style="color:var(--primary-color)"></i> Doanh thu theo l·ªõp / kh√≥a h·ªçc</h3>
                </div>
                <div class="table-wrapper">
                    <table>
                        <thead>
                            <tr><th>L·ªõp</th><th>Kh√≥a h·ªçc</th><th>T·ªïng h·ªçc ph√≠</th><th>ƒê√£ thu</th><th>Ch∆∞a thu</th><th>T·ª∑ l·ªá thu</th></tr>
                        </thead>
                        <tbody id="classRevenueBody"></tbody>
                    </table>
                </div>
            </div>
            <div style="display:grid;grid-template-columns:1fr 1fr;gap:1.25rem">
                <div class="card">
                    <div class="card-header"><h3 style="font-size:.9rem">Ph√¢n b·ªï doanh thu theo l·ªõp</h3></div>
                    <div id="classPieChart"></div>
                </div>
                <div class="card">
                    <div class="card-header"><h3 style="font-size:.9rem">T·ª∑ l·ªá thu ti·ªÅn</h3></div>
                    <div id="classProgressList"></div>
                </div>
            </div>
        </div>

        <!-- TAB: DEBT -->
        <div class="tab-content" id="tab-debt">
            <div class="card">
                <div class="card-header">
                    <h3><i class="fas fa-exclamation-circle" style="color:var(--danger)"></i> T·ªïng h·ª£p c√¥ng n·ª£</h3>
                </div>
                <div id="debtSummary"></div>
            </div>
            <div class="card">
                <div class="card-header">
                    <h3><i class="fas fa-table"></i> Chi ti·∫øt phi·∫øu n·ª£ qu√° h·∫°n</h3>
                </div>
                <div class="table-wrapper">
                    <table>
                        <thead><tr><th>H·ªçc vi√™n</th><th>L·ªõp</th><th>S·ªë n·ª£</th><th>H·∫°n ƒë√≥ng</th><th>Qu√° h·∫°n (ng√†y)</th></tr></thead>
                        <tbody id="overdueBody"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- TAB: PAYMENT HISTORY -->
        <div class="tab-content" id="tab-payments">
            <div class="card">
                <div class="card-header">
                    <h3><i class="fas fa-history" style="color:var(--primary-color)"></i> L·ªãch s·ª≠ thu ti·ªÅn</h3>
                    <span id="payHistoryTotal" style="font-size:.85rem;color:var(--primary-color);font-weight:700"></span>
                </div>
                <div class="filter-bar">
                    <input type="search" id="paySearch" placeholder="üîç T√¨m h·ªçc vi√™n..." oninput="renderPayHistory()">
                    <select id="payMethodFilter" onchange="renderPayHistory()">
                        <option value="">T·∫•t c·∫£ h√¨nh th·ª©c</option>
                        <option>Ti·ªÅn m·∫∑t</option>
                        <option>Chuy·ªÉn kho·∫£n</option>
                    </select>
                </div>
                <div class="table-wrapper">
                    <table>
                        <thead><tr><th>M√£ thanh to√°n</th><th>H·ªçc vi√™n</th><th>S·ªë ti·ªÅn</th><th>Ng√†y</th><th>H√¨nh th·ª©c</th><th>NV x√°c nh·∫≠n</th><th>Ghi ch√∫</th></tr></thead>
                        <tbody id="payHistoryBody"></tbody>
                    </table>
                </div>
            </div>
        </div>

    </main>
</div>

<div class="toast-container" id="toastContainer"></div>

<script src="accountant-data.js"></script>
<script src="FinancialReport.js"></script>
</body>
</html>
